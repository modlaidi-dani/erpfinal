{% extends "base.html" %}
{% load static %}

{% block body_class %}{% endblock %}

{% block content %}
<div 
x-data="{ 
	menuOpen: false, 
	basicSignInModal: false,
	basicSignUpModal: false,
	advanceSignInModal: false,
	advanceSignUpModal: false,
}" 
class="flex flex-col min-h-screen custom-scrollbar"
>
<!-- start::Black overlay -->
<!-- end::Black overlay -->
 {% include 'header.html' %}
 {% include 'tabs.html' with active_tab="achat" %}
 <div class=" w-full flex flex-row">
	{% include "sidebar_achats.html" %}
  <div class="h-full w-full">
	<!-- Main content header -->
		 <main class="block w-full h-full px-2 overflow-hidden ">
					<body class="antialiased sans-serif">
						<div class=" h-2"></div>
						<div 
							class="container mx-auto py-6 px-4"
							x-data="invoices()"
							x-init="initData()"
							x-cloak
						>
						<div class="flex justify-between">
							<h2 class="text-2xl font-bold mb-6 pb-2 tracking-wider uppercase">Bon Commande de Fournisseur</h2>
							<div>
								<div class="relative mr-4 inline-block">
									<div class="text-gray-500 cursor-pointer w-10 h-10 rounded-full bg-gray-100 hover:bg-gray-300 inline-flex items-center justify-center" @mouseenter="showTooltip = true" @mouseleave="showTooltip = false" @click="printInvoice()">
										<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-printer" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
											<rect x="0" y="0" width="24" height="24" stroke="none"></rect>
											<path d="M17 17h2a2 2 0 0 0 2 -2v-4a2 2 0 0 0 -2 -2h-14a2 2 0 0 0 -2 2v4a2 2 0 0 0 2 2h2" />
											<path d="M17 9v-4a2 2 0 0 0 -2 -2h-6a2 2 0 0 0 -2 2v4" />
											<rect x="7" y="13" width="10" height="8" rx="2" />
										</svg>				  
									</div>
									<div x-show.transition="showTooltip" class="z-40 shadow-lg text-center w-full block absolute right-0 top-0 p-2 mt-12 rounded-lg bg-gray-800 text-white text-xs">
										Print this invoice!
									</div>
								</div>
								<div class="relative inline-block">
									<div class="text-gray-500 cursor-pointer w-10 h-10 rounded-full bg-gray-100 hover:bg-gray-300 inline-flex items-center justify-center" @mouseenter="showTooltip2 = true" @mouseleave="showTooltip2 = false" @click="openPreview=true">
										<svg id='eye_24' width='24' height='24' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'><rect width='24' height='24' stroke='none' fill='#000000' opacity='0'/>
											<g transform="matrix(1 0 0 1 12 12)" >
											<g style="" >
											<g transform="matrix(1 0 0 1 0 0)" >
											<path style="stroke: none; stroke-width: 2; stroke-dasharray: none; stroke-linecap: round; stroke-dashoffset: 0; stroke-linejoin: round; stroke-miterlimit: 4; fill: none; fill-rule: nonzero; opacity: 1;" transform=" translate(-12, -12)" d="M 0 0 L 24 0 L 24 24 L 0 24 z" stroke-linecap="round" />
											</g>
											<g transform="matrix(1 0 0 1 -0.25 -0.25)" >
											<circle style="stroke: rgb(0,0,0); stroke-width: 1.5; stroke-dasharray: none; stroke-linecap: round; stroke-dashoffset: 0; stroke-linejoin: round; stroke-miterlimit: 4; fill: none; fill-rule: nonzero; opacity: 1;" cx="0" cy="0" r="2" />
											</g>
											<g transform="matrix(1 0 0 1 -0.25 -0.25)" >
											<path style="stroke: rgb(0,0,0); stroke-width: 1.5; stroke-dasharray: none; stroke-linecap: round; stroke-dashoffset: 0; stroke-linejoin: round; stroke-miterlimit: 4; fill: none; fill-rule: nonzero; opacity: 1;" transform=" translate(-12, -12)" d="M 22 12 C 19.333 16.667 16 19 12 19 C 8 19 4.667 16.667 2 12 C 4.667 7.333 8 5 12 5 C 16 5 19.333 7.333 22 12" stroke-linecap="round" />
											</g>
											</g>
											</g>
										</svg>		  
									</div>
									<div x-show.transition="showTooltip2" class="z-40 shadow-lg text-center w-32 block absolute right-0 top-0 p-2 mt-12 rounded-lg bg-gray-800 text-white text-xs">
										Preview
									</div>
								</div>
							</div>
						</div>
				
						<div class="flex mb-8 justify-between">
							<div class="w-2/4">
								<div class="mb-2 md:mb-1 md:flex items-center">
									<label class="w-32 text-gray-800 block font-bold text-sm uppercase tracking-wide">Numéro de Bon</label>
									<span class="mr-4 inline-block  md:block">:</span>
									<div class="flex-1">
									<input class="bg-gray-200 appearance-none border-2 border-gray-200 rounded w-48 py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-blue-500" id="inline-full-name" type="text" placeholder="eg. #BON-100001" x-model="invoiceNumber">
									</div>
								</div>					
								<div class="mb-2 md:mb-1 md:flex items-center">
									<label class="w-32 text-gray-800 block font-bold text-sm uppercase tracking-wide">Date de Bon</label>
									<span class="mr-4 inline-block  md:block">:</span>
									<div class="flex-1">
									<input class="bg-gray-200 appearance-none border-2 border-gray-200 rounded w-48 py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-blue-500 " type="date" {% if request.session.role != 'manager' %}disabled{% endif %} x-model="invoiceDate">
									</div>
								</div>
							</div>							
						</div>
				
					
							<div class="flex  justify-between mb-8">
								<div class="w-full md:w-1/3 mb-2 md:mb-0">									
									<div class="mb-1 ">
										<label class="text-gray-800 block mb-1 font-bold text-sm uppercase tracking-wide">Destinataire :</label>
										<select
										 class="mb-1 bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white"
										 id="fournisseur"
										 name="fournisseur"	
										 x-model="destinataire"									 
										 x-on:change="
											 destinataire=$event.target.value;
										 "
										 required  
										 >
										    <option value="" disabled selected> Aucun </option>
											<option value="vente"> Vente </option>
											<option value="stock"> Stock </option>
											<option value="econome"> Econome </option>	
										</select>											
									</div>
									<div class="mb-1 ">
										<label class="text-gray-800 block mb-1 font-bold text-sm uppercase tracking-wide">Fournisseur :</label>
										<select
										 class="mb-1 bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white"
										 id="fournisseur"
										 name="fournisseur"										 
										 x-on:change="
											 billing.name=$event.target.value;
										 "
										 required  
										 >
										 <option value="" disabled selected>Aucun </option>
										 {% for fournisseur in fournisseurs %}
											 <option value="{{ fournisseur.acronym}}">
												 {{ fournisseur.acronym }} 
											 </option>
										 {% endfor %}
										</select>											
									</div>
									<div class="mb-1 ">
										<label class="text-gray-800 block mb-1 font-bold text-sm uppercase tracking-wide">Entrepot :</label>
										<select
										 class="mb-1 bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white"
										 id="fournisseur"
										 name="fournisseur"
										 x-model="entrepot"										 
										 x-on:change="
											 entrepot=$event.target.value;
										 "
										 required  
										 >
										 <option value="" disabled selected>Aucun </option>
										 {% for ent in entrepots %}
											 <option value="{{ ent.name}}">
												 {{ ent.name }} 
											 </option>
										 {% endfor %}
										</select>											
									</div>
								
								</div>
							</div>

							<div x-data="{ tab: 1 }" x-cloak class="my-10 antialiased ">
								<div class="relative flex flex-col rounded-lg shadow-xs overflow-hidden">         
									<div class="flex space-x-8 bg-white border-b border-gray-200 ">
										<button
											type="button"
											class="focus:outline-none text-black py-2 px-1 border-t-2 text-md tracking-wide font-semibold border-transparent"
											x-on:click="tab = 1"
											:class="{ 'text-white bg-gray-700 rounded-t-lg ': tab === 1 }"
										>
											Informations Bon de Commande
										</button>
										<button
											type="button"
											class="focus:outline-none text-black py-2 px-1 border-t-2 text-md tracking-wide font-semibold border-transparent"
											x-on:click="tab = 2"
											:class="{ 'text-white bg-gray-700 rounded-t-lg ': tab === 2 }"
										>
											Produits du Bon
										</button>						  
									</div>     
									<div class="border-b-2 border-gray-100">				   
										<div x-show="tab === 1">
											<div class="flex  justify-between mb-8 py-4">
											<div class="w-full md:w-1/3 mb-2 md:mb-0">
												<div class="mb-4">
													<label class="block text-gray-700 font-semibold mb-2" for="modReg">
														Mode de Réglement:
													</label>
													<select
														class="appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
														id="modReg"
														name="modReg"
														x-model="modeReglement"
														x-on:change="
															ModeReglement = $event.target.selectedOptions[0].value;                     
															showBanque = $event.target.value == 2;
														"
														required  
													>
													<option value=""selected > Aucun </option>
													{% for mode in modeReg %}
														<option value="{{ mode.id }}" >
															{{ mode.label }} 
														</option>
														{% endfor %}
													</select>
												</div>
												<div class="mb-4">
													<div x-show="showBanque">
													<!-- Show this div when 'cheque' is selected -->
													<div class="mb-4">
													<label class="block text-gray-700 font-semibold mb-2" for="banque">
														Banque :
													</label>
													<select
														class="appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline cursor-pointer"
														id="banque"
														name="banque"
														x-model="banque"														
														required  
														x-on:change ="banque = $event.target.selectedOptions[0].value;"
														>
														<option value="" disabled selected> Selectionnez  Banque</option>
														{% for banque in banques  %}
															<option value="{{banque.pk}}"> {{banque.nom}} </option>
														{% endfor %}
													</select>
													</div>
													<label for="chequeInput" class="block font-bold mt-4"> Cheque Number: </label>
													<input
															type="text"
															id="chequeInput"
															name="chequeInput"
															x-model="numCheque"
															class="border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline mt-1"
													>
													</div>
												</div>
												<div class="mb-4 border-b">
													<label class="block text-gray-700 font-semibold mb-2" for="echReg">
														Taux de change	:
													</label>
													<input
														class="appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
														type="text"
														id="tauxchange"
														name="tauxchange"
														x-model="tauxchange"
													>
												</div>
												<div class="mb-4 border-b">
													<label class="block text-gray-700 font-semibold mb-2" for="echReg">
														Estimation des Charges	:
													</label>
													<input
														class="appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
														type="text"
														id="chargesApproximatively"
														name="chargesApproximatively"
														x-model="chargesApproximatively"
													>
												</div>
												
												<h2 class="block text-gray-700 text-lg font-bold mb-2">Taxes</h2>
												<div class="mb-4">
													<label class="block text-gray-700 font-semibold mb-2" for="echReg">
														TVA	:
													</label>
													<input
														class="appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
														type="number"
														id="tva"
														name="tva"
														x-model="tva"
													>												
												</div>
												<div class="">
													<label class="block text-gray-700 font-semibold mb-2" for="echReg">
														DD	:
													</label>
													<input
														class="appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
														type="number"
														id="dd"
														name="dd"
														x-model="dd"
													>
													
												</div>
												<div class="">
													<label class="block text-gray-700 font-semibold mb-2" for="echReg">
														TCS	:
													</label>
													<input
														class="appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
														type="number"
														id="tcs"
														name="tcs"
														x-model="tcs"
													>											
												</div>							   
											</div>	
											</div>
										
										</div>
										<div x-show="tab === 2">
											<table class="w-full divide-y divide-gray-200">
												<thead class="bg-gray-50">
													<tr>
														<th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Des</th>
														<th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ref</th>											
														<th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Qty</th>
														<th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">PU USD</th>
														<th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total USD</th>
														<th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">PU DZ</th>
														<th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total DZ</th>
														<th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Transport %</th>
														<th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Transport Prix</th>
														<th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tax %</th>
														<th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total Tax</th>
														<th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Charges %</th>
														<th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Charges</th>
														<th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total Charges</th>
														<th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Anda</th>
														<th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Droit Réalisation</th>
													</tr>
												</thead>
												<tbody class="bg-white divide-y divide-gray-200">
													<template x-for="item in items">
														<tr>
															<td class="px-2 py-4 whitespace-nowrap text-sm text-gray-500" x-text="item.name"></td>
															<td class="px-2 py-4 whitespace-nowrap text-sm text-gray-500" x-text="item.ref"></td>
															<td class="px-2 py-4 whitespace-nowrap text-sm text-gray-500" x-text="item.qty"></td>
															<td class="px-2 py-4 whitespace-nowrap text-sm text-gray-500" x-text="item.prixUnitairUSD"></td>
															<td class="px-2 py-4 whitespace-nowrap text-sm text-gray-500" x-text="item.totalPriceUSD"></td>
															<td class="px-2 py-4 whitespace-nowrap text-sm text-gray-500" x-text="item.prixUnitaireDZ"></td>
															<td class="px-2 py-4 whitespace-nowrap text-sm text-gray-500" x-text="item.totalPriceDZ"></td>
															<td class="px-2 py-4 whitespace-nowrap text-sm text-gray-500" x-text="item.transportPercent"></td>
															<td class="px-2 py-4 whitespace-nowrap text-sm text-gray-500" x-text="item.transportPrice"></td>
															<td class="px-2 py-4 whitespace-nowrap text-sm text-gray-500" x-text="item.taxPercent"></td>
															<td class="px-2 py-4 whitespace-nowrap text-sm text-gray-500" x-text="item.totalTax"></td>
															<td class="px-2 py-4 whitespace-nowrap text-sm text-gray-500" x-text="item.chargesPercent"></td>
															<td class="px-2 py-4 whitespace-nowrap text-sm text-gray-500" x-text="item.charges"></td>
															<td class="px-2 py-4 whitespace-nowrap text-sm text-gray-500" x-text="item.Totalcharges"></td>
															<td class="px-2 py-4 whitespace-nowrap text-sm text-gray-500" x-text="item.anda"></td>
															<td class="px-2 py-4 whitespace-nowrap text-sm text-gray-500" x-text="item.DroitRealisation"></td>
														</tr>
													</template>
												</tbody>
											</table>
											<button class="mt-6 bg-white hover:bg-gray-100 text-gray-700 font-semibold py-2 px-4 text-sm border border-gray-300 rounded shadow-sm" x-on:click="openModal = !openModal">
												Ajouter produits au bon
											</button>
										</div>									
									</div>
								
										<div class="py-2">
												<div class="">
													<table class=" divide-y divide-gray-200">
														<thead class="bg-gray-50">
															<tr>
																<th class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Total Prix USD</th>
																<th class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Total Prix DZ</th>
																<th class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Total Charges</th>
																<th class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Total Prix Transport</th>
																<th class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Total Taxe</th>
															</tr>
														</thead>
														<tbody class="bg-white divide-y divide-gray-200">
															<tr>														
																<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-right" x-text="totalPriceUSD"></td>														
																<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-right" x-text="totalPriceDZ"></td>													
																<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-right" x-text="totalCharges"></td>												
																<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-right" x-text="totalTransportPrice"></td>												
																<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-right" x-text="totalTax"></td>
															</tr>
														</tbody>
													</table>
												</div>
										</div>															
										
										<div class="flex justify-between">
											<div></div>
											<button class="mt-6 bg-white hover:bg-gray-100 text-gray-700 font-semibold py-2 px-4 text-sm border border-gray-300 rounded shadow-sm" type="submit" x-on:click="validateBon">Valider le Bon & imprimer</button>
										</div>
								
								</div>
							</div>
							
					
							<!-- Modal -->
							<div style=" background-color: rgba(0, 0, 0, 0.8)" class="fixed z-40 top-0 right-0 left-0 overflow-y-auto  bottom-0 h-full w-full " x-show.transition.opacity="openModal">
								<div class="p-4 max-w-xl mx-auto relative absolute left-0 right-0 overflow-hidden mt-24">
									<div class="shadow absolute right-0 top-0 w-10 h-10 rounded-full bg-white text-gray-500 hover:text-gray-800 inline-flex items-center justify-center cursor-pointer"
										x-on:click="openModal = !openModal">
										<svg class="fill-current w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
											<path
												d="M16.192 6.344L11.949 10.586 7.707 6.344 6.293 7.758 10.535 12 6.293 16.242 7.707 17.656 11.949 13.414 16.192 17.656 17.606 16.242 13.364 12 17.606 7.758z" />
										</svg>
									</div>
					
									<div class="shadow w-full rounded-lg bg-white overflow-y-auto overflow-x-hidden block p-8">										
										<h2 class="font-bold text-2xl mb-6 text-gray-800 border-b pb-2">Ajouter Produits au Bon</h2>	
										<label class="block text-gray-700 font-semibold mb-2" for="price">
														Produit :
													</label>
													<div class="relative">
														<input type="hidden" :value="selected.value">
														<input type="text" x-model="search" class="w-full px-4 py-3 rounded-lg shadow-sm focus:outline-none focus:shadow-outline bg-gray-50 text-gray-600 font-medium"
															placeholder="Cliquer pour rechercher ..." @click="optionsVisible = !optionsVisible">
														<div class="absolute bg-white shadow-lg w-full overflow-y-scroll z-40" style="max-height:200px;" x-show="optionsVisible">
															<template x-for="option in filteredOptions()">
																<a class="cursor-pointer border-b py-2 px-2 text-left hover:bg-gray-100" 
																	@click.prevent="
																		item.ref = option.ref;
																		item.name = option.name;																		
																		item.rate = option.rate;																		
																		selected = option;
																		optionsVisible = false;
																		search='';

																	"
																	x-text="option.name"
																	style="display: block;"></a>
															</template>
														</div>
														
													</div>								 
										<select
						 							class="appearance-none border rounded w-full mb-8 py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
						 							id="entrepot"
						 							name="entrepot"
													x-model="item.ref"
						 							x-on:change="
													 item.name= $event.target.value; 
													 item.ref= $event.target.selectedOptions[0].dataset.ref;
													"
						 							required  
					 							 	>
													<option value="" disabled selected>Select produit</option>
													{% for entrepot in stock %}
						 								<option value="{{ entrepot.reference }}" data-ref="{{entrepot.reference}}" >
							 								{{ entrepot.name }} 
						 								</option>
					   							{% endfor %}
					  					</select>
										  <div class="mb-4 w-full mr-2">
											<div class="mb-4 w-full mr-2">
												<label class="text-gray-800 block mb-1 font-bold text-sm uppercase tracking-wide">Quantité</label>
												<input class="text-left mb-1 bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-blue-500" type="text" x-model="item.quantity">
											</div>
											<div class="flex">
												<div class="mb-4 w-full mr-2">
													<label class="text-gray-800 block mb-1 font-bold text-sm uppercase tracking-wide">Prix.U USD</label>
													<input class="text-left mb-1 bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-blue-500" type="text" x-model="item.prixUnitairUSD">
												</div>
												<div class="mb-4 w-full mr-2">
													<label class="text-gray-800 block mb-1 font-bold text-sm uppercase tracking-wide">Prix Total USD</label>
													<input class="text-left mb-1 bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-blue-500" type="text" x-model="item.totalPriceUSD">
												</div>
											</div>
											<div class="flex">
												<div class="mb-4 w-full mr-2">
													<label class="text-gray-800 block mb-1 font-bold text-sm uppercase tracking-wide">Prix.U DZ</label>
													<input class="text-left mb-1 bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-blue-500" type="text" x-model="item.prixUnitaireDZ">
												</div>
												<div class="mb-4 w-full mr-2">
													<label class="text-gray-800 block mb-1 font-bold text-sm uppercase tracking-wide">Prix Total DZ</label>
													<input class="text-left mb-1 bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-blue-500" type="text" x-model="item.totalPriceDZ">
												</div>
											</div>
											<div class="flex">
												<div class="mb-4 w-full mr-2">
													<label class="text-gray-800 block mb-1 font-bold text-sm uppercase tracking-wide">% Transport</label>
													<input class="text-left mb-1 bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-blue-500" type="text" x-model="item.transportPercent">
												</div>
												<div class="mb-4 w-full mr-2">
													<label class="text-gray-800 block mb-1 font-bold text-sm uppercase tracking-wide">Prix Transport</label>
													<input class="text-left mb-1 bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-blue-500" type="text" x-model="item.transportPrice">
												</div>
											</div>
											<div class="flex">
												<div class="mb-4 w-full mr-2">
													<label class="text-gray-800 block mb-1 font-bold text-sm uppercase tracking-wide">% Tax</label>
													<input class="text-left mb-1 bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-blue-500" type="text" x-model="item.taxPercent">
												</div>
												<div class="mb-4 w-full mr-2">
													<label class="text-gray-800 block mb-1 font-bold text-sm uppercase tracking-wide">Taxe Totale</label>
													<input class="text-left mb-1 bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-blue-500" type="text" x-text="calculateItemTax(item.taxPercent)">
												</div>
											</div>
											<div class="flex">
												<div class="mb-4 w-full mr-2">
													<label class="text-gray-800 block mb-1 font-bold text-sm uppercase tracking-wide">% Charges</label>
													<input class="text-left mb-1 bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-blue-500" type="text" x-model="item.chargesPercent">
												</div>
												<div class="mb-4 w-full mr-2">
													<label class="text-gray-800 block mb-1 font-bold text-sm uppercase tracking-wide">Charges</label>
													<input class="text-left mb-1 bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-blue-500" type="text" x-model="item.charges">
												</div>
												<div class="mb-4 w-full mr-2">
													<label class="text-gray-800 block mb-1 font-bold text-sm uppercase tracking-wide">Charges Totales</label>
													<input class="text-left mb-1 bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-blue-500" type="text" x-model="item.Totalcharges">
												</div>
											</div>
											<div class="mb-4 w-full mr-2">
												<label class="text-gray-800 block mb-1 font-bold text-sm uppercase tracking-wide">Anda</label>
												<input class="text-left mb-1 bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-blue-500" type="text" x-model="item.anda">
											</div>
											<div class="mb-4 w-full mr-2">
												<label class="text-gray-800 block mb-1 font-bold text-sm uppercase tracking-wide">Droit de Réalisation</label>
												<input class="text-left mb-1 bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-blue-500" type="text" x-model="item.DroitRealisation">
											</div>
										</div>
										<div class="mt-8 text-right">
											<button type="button" class="bg-white hover:bg-gray-100 text-gray-700 font-semibold py-2 px-4 border border-gray-300 rounded shadow-sm mr-2" @click="openModal = !openModal">
												Annuler
											</button>
											<button type="button" class="bg-gray-800 hover:bg-gray-700 text-white font-semibold py-2 px-4 border border-gray-700 rounded shadow-sm" @click="addItem()">
												Ajouter
											</button>
										</div>
								
									
						
									</div>
								</div>
							</div>
							<!-- /Modal -->				
						</div>
						<script>
								
							
							function invoices() {
								return {
									items: [],
									invoiceNumber: 0,
									invoiceDate: new Date().toISOString().slice(0, 10),
									openPreview: false,
									entrepot: '',
									modeReglement: '',
									banque: '',
									showBanque: false,
									numCheque: '',
									echeanceReg: '',
									tva: '',
									monnaie: '',
									destinataire: '',
									netTotal: 0,

									// Add fields for all x-models
									chargesApproximatively: 0,
									TransportApproximatively: 0,
									tauxchange: 0,
									dd: 0,
									tcs: 0,
									tva: 0,
									totalTax: 0,
									// Add any additional fields if needed

									// Method to calculate total tax
									calculateTotalTax() {
										const dd = parseFloat(this.dd) || 0;
										const tcs = parseFloat(this.tcs) || 0;
										const tva = parseFloat(this.tva) || 0;
										this.totalTax = (dd + tcs) * tva;
										
									},
									calculateItemTax(itemPercent){
										tax = this.calculateTotalTax() * ( parseFloat(itemPercent) / 100 );
										return tax;
									},								
									calculateItemCharge(itemTotal){
										charge = this.chargesApproximatively / itemTotal;
										return charge;
									},
									calculateItemTransport(itemPercent){
										transport = this.TransportApproximatively * ( parseFloat(itemPercent) / 100 );
										return transport;
									},

									item: {
										id: '',
										name: '',
										ref: '',
										fournisseur: '',
										qty: 0,
										prixUnitairUSD: 0,
										totalPriceUSD: 0,
										prixUnitaireDZ: 0,
										totalPriceDZ: 0,
										transportPercent: 0,
										transportPrice: 0,
										taxPercent: 0,
										totalTax: 0,
										chargesPercent: 0,
										charges: 0,
										Totalcharges: 0,
										anda: 0,
										DroitRealisation: 0,			
									},
					
									billing: {
										name: '',
										address: '',
										extra: '',
										phone:''
									},
								
					
									showTooltip: false,
									showTooltip2: false,
									openModal: false,
									showQuantity:false,
					
									showModal(){
										document.getElementById('myForm').reset(); 
										
										this.openModal =true;
									},
					
									addItem() {
										this.items.push({
											id: this.generateUUID(),
											name: this.item.name,
											qty: this.item.qty,
											rate: this.item.rate,
											ref: this.item.ref,
											fournisseur: this.item.fournisseur,
											//gst: this.calculateGST(this.item.gst, this.item.rate),
											total: this.item.qty * this.item.rate
										})
							
					
										this.item.id = '';
										this.item.name = '';
										this.item.fournisseur='';
										this.item.qty = 0;
										this.item.rate = 0;
										//this.item.gst = 18;
										this.item.total = 0;
										document.getElementById('myForm').reset(); 

									},
									stocks:[],
									selected:'',
									optionsVisible: false,
									search: "",
									filteredOptions() {
												return this.stocks.filter((option) => {
													return (option.name.toLowerCase().includes(this.search.toLowerCase()));
												});
									},
									initData(){										
										itemsData={{stock | safe}};
										for (const itemData of itemsData) {							 
											const item = {
												name: itemData.name,
												ref: itemData.reference,
												rate: itemData.prix_achat,
											};
											this.stocks.push(item);
										}	
										console.log(this.stocks)	
									},
									printInvoice() {
										var printContents = this.$refs.printTemplate.innerHTML;
										var originalContents = document.body.innerHTML;
										document.body.innerHTML = printContents;
										window.print();
										window.location.reload();
										console.log(originalContents)
										document.body.innerHTML = originalContents;
					
										this.items=[];
									},
									validateBon(){										
										
										const dataObj = {
											IdBon : this.invoiceNumber,
											dateBp:this.invoiceDate,
											FournisseurInfo:this.billing,																					
											produits:this.items,
											entrepot:this.entrepot,	
											modeReglement:this.modeReglement,
											banque:this.banque,
											numCheque:this.numCheque,
											destinataire:this.destinataire,
											echeanceReg:this.echeanceReg,
											tva:this.tva,
											monnaie:this.monnaie,
										};

										 axios.post('', {
												formData: dataObj
											}, {
												headers: {
													'Content-Type': '',
													'X-CSRFToken': getCookie('csrftoken'),
												}
											})
											.then((response) => {
												// {# response.data.message #}�
												alert(response)							
											})
											.catch((error) => {
												alert(error)
											});
											
									},
									
								}
							}
							function getCookie(name) {
								var cookieValue = null;
								if (document.cookie && document.cookie !== '') {
									var cookies = document.cookie.split(';');
									for (var i = 0; i < cookies.length; i++) {
										var cookie = cookies[i].trim();
										// Does this cookie string begin with the name we want?
										if (cookie.substring(0, name.length + 1) === (name + '=')) {
											cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
											break;
										}
									}
								}
								return cookieValue;
							}
						</script>
					</body>
        
				
				
		</main>		
	<!-- end Main content  -->

  </div>
</div>
</div>
</div>

{% endblock content %}
