{% extends "base.html" %}
{% load static %}

{% block body_class %}{% endblock %}

{% block content %}
<div 
x-data="{ 
	menuOpen: false, 
	basicSignInModal: false,
	basicSignUpModal: false,
	advanceSignInModal: false,
	advanceSignUpModal: false,
}" 
class="flex flex-col min-h-screen custom-scrollbar"
>
<!-- start::Black overlay -->
<div :class="menuOpen ? 'block' : 'hidden'" @click="menuOpen = false" class="fixed  inset-0 bg-black opacity-50 transition-opacity lg:hidden"></div>
<!-- end::Black overlay -->
 {% include 'header.html' %}
 {% include 'tabs.html' with active_tab="vente" %}
 <div class=" w-full flex flex-row">
	{% include "sidebar_ventes.html" %}
  <div class="h-full w-full">
	<!-- Main content header -->
	<body class="antialiased sans-serif">
			
		<div class="h-2"></div>
		<div 
		  class="container mx-auto py-6 px-4"
		  x-data="invoices()"
		  x-init="initData()"
		  x-cloak
		>
		  <div class="flex justify-between">
			 <h2 class="text-2xl font-bold mb-6 pb-2 tracking-wider uppercase">Bon de Livraison - Edit -</h2>
			 <div>
				<div class="relative mr-4 inline-block">
					 <div class="text-gray-500 cursor-pointer w-10 h-10 rounded-full bg-gray-100 hover:bg-gray-300 inline-flex items-center justify-center" @mouseenter="showTooltip = true" @mouseleave="showTooltip = false" @click="printInvoice()">
						 <svg id='Print_24' width='24' height='24' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'><rect width='24' height='24' stroke='none' fill='#000000' opacity='0'/>
							 <g transform="matrix(1 0 0 1 12 12)" >
							 <path style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-dashoffset: 0; stroke-linejoin: miter; stroke-miterlimit: 4; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;" transform=" translate(-12, -12)" d="M 6 3 L 6 7 L 5 7 C 3.35 7 2 8.35 2 10 L 2 17 L 6 17 L 6 21 L 18 21 L 18 17 L 22 17 L 22 10 C 22 8.35 20.65 7 19 7 L 18 7 L 18 3 L 6 3 z M 8 5 L 16 5 L 16 7 L 8 7 L 8 5 z M 5 9 L 19 9 C 19.552 9 20 9.448 20 10 L 20 15 L 18 15 L 18 13 L 6 13 L 6 15 L 4 15 L 4 10 C 4 9.448 4.448 9 5 9 z M 18 10 C 17.447715250169207 10 17 10.447715250169207 17 11 C 17 11.552284749830793 17.447715250169207 12 18 12 C 18.552284749830793 12 19 11.552284749830793 19 11 C 19 10.447715250169207 18.552284749830793 10 18 10 z M 8 15 L 16 15 L 16 19 L 8 19 L 8 15 z" stroke-linecap="round" />
							 </g>
							 </svg>			  
					 </div>
					 <div x-show.transition="showTooltip" class="z-40 shadow-lg text-center w-32 block absolute right-0 top-0 p-2 mt-12 rounded-lg bg-gray-800 text-white text-xs">
						 Print this invoice!
					 </div>
				</div>
				<div class="relative mr-4 inline-block">
				 <div class="text-gray-500 cursor-pointer w-10 h-10 rounded-full bg-gray-100 hover:bg-gray-300 inline-flex items-center justify-center" @mouseenter="showTooltip2 = true" @mouseleave="showTooltip2 = false" @click="openPrintTemplate">
					 <svg id='File_Preview_24' width='24' height='24' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'><rect width='24' height='24' stroke='none' fill='#000000' opacity='0'/>
						 <g transform="matrix(0.69 0 0 0.69 12 12)" >
						 <path style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-dashoffset: 0; stroke-linejoin: miter; stroke-miterlimit: 4; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;" transform=" translate(-18.75, -17.5)" d="M 6 3 L 6 29 L 11.550781 29 C 11.138781 28.531 10.899328 28.199484 10.861328 28.146484 L 10.058594 27 L 8 27 L 8 5 L 18 5 L 18 11 L 24 11 L 24 20.171875 C 24.704 20.284875 25.371 20.44825 26 20.65625 L 26 9.5859375 L 19.414062 3 L 6 3 z M 20 6.4140625 L 22.585938 9 L 20 9 L 20 6.4140625 z M 22 22 C 16 22 12.5 27 12.5 27 C 12.5 27 16 32 22 32 C 28 32 31.5 27 31.5 27 C 31.5 27 28 22 22 22 z M 22 24 C 25.18 24 27.562078 25.772 28.830078 27 C 27.560078 28.229 25.178 30 22 30 C 18.82 30 16.437922 28.228 15.169922 27 C 16.439922 25.771 18.822 24 22 24 z M 22 24 C 20.343 24 19 25.343 19 27 C 19 28.657 20.343 30 22 30 C 23.657 30 25 28.657 25 27 C 25 26.695 24.941422 26.406859 24.857422 26.130859 C 24.618422 26.642859 24.102 27 23.5 27 C 22.672 27 22 26.328 22 25.5 C 22 24.898 22.357141 24.381578 22.869141 24.142578 C 22.593141 24.058578 22.305 24 22 24 z" stroke-linecap="round" />
						 </g>
					 </svg>
				 </div>
				 <div x-show.transition="showTooltip2" class="z-40 shadow-lg text-center w-32 block absolute right-0 top-0 p-2 mt-12 rounded-lg bg-gray-800 text-white text-xs">
					 View Page
				 </div>
			</div>
				<div class="relative mr-4 inline-block">
					 <div class="text-gray-500 cursor-pointer w-10 h-10 rounded-full bg-gray-100 hover:bg-gray-300 inline-flex items-center justify-center" @mouseenter="showTooltip2 = true" @mouseleave="showTooltip2 = false" @click="window.location.reload()">
						 <svg id='Refresh_24' width='24' height='24' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'><rect width='24' height='24' stroke='none' fill='#000000' opacity='0'/>
							 <g transform="matrix(0.83 0 0 0.83 12 12)" >
							 <path style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-dashoffset: 0; stroke-linejoin: miter; stroke-miterlimit: 4; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;" transform=" translate(-12, -12)" d="M 7.1601562 3 L 8.7617188 5 L 18 5 C 18.551 5 19 5.448 19 6 L 19 15 L 16 15 L 20 20 L 24 15 L 21 15 L 21 6 C 21 4.346 19.654 3 18 3 L 7.1601562 3 z M 4 4 L 0 9 L 3 9 L 3 18 C 3 19.654 4.346 21 6 21 L 16.839844 21 L 15.238281 19 L 6 19 C 5.449 19 5 18.552 5 18 L 5 9 L 8 9 L 4 4 z" stroke-linecap="round" />
							 </g>
						</svg>
					 </div>
					 <div x-show.transition="showTooltip2" class="z-40 shadow-lg text-center w-32 block absolute right-0 top-0 p-2 mt-12 rounded-lg bg-gray-800 text-white text-xs">
						 Reload Page
					 </div>
				</div>
				<div class="relative inline-block">
				 <div class="text-gray-500 cursor-pointer w-10 h-10 rounded-full bg-gray-100 hover:bg-gray-300 inline-flex items-center justify-center" @mouseenter="showTooltip2 = true" @mouseleave="showTooltip2 = false" @click="saveItem">
					 <svg id='Save_24' width='24' height='24' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'><rect width='24' height='24' stroke='none' fill='#000000' opacity='0'/>
						 <g transform="matrix(1.54 0 0 1.54 12 12)" >
						 <path style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-dashoffset: 0; stroke-linejoin: miter; stroke-miterlimit: 4; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;" transform=" translate(-7.5, -7.5)" d="M 2.59375 1 C 1.71875 1 1 1.71875 1 2.59375 L 1 12.40625 C 1 13.28125 1.71875 14 2.59375 14 L 12.40625 14 C 13.28125 14 14 13.28125 14 12.40625 L 14 4.042969 L 10.957031 1 Z M 2.59375 2 L 3 2 L 3 5 C 3 5.546875 3.453125 6 4 6 L 10 6 C 10.546875 6 11 5.546875 11 5 L 11 2.457031 L 13 4.457031 L 13 12.40625 C 13 12.742188 12.738281 13 12.40625 13 L 11 13 L 11 10 C 11 9.453125 10.546875 9 10 9 L 5 9 C 4.453125 9 4 9.453125 4 10 L 4 13 L 2.59375 13 C 2.257813 13 2 12.738281 2 12.40625 L 2 2.59375 C 2 2.257813 2.257813 2 2.59375 2 Z M 4 2 L 7 2 L 7 4 L 9 4 L 9 2 L 10 2 L 10 5 L 4 5 Z M 5 10 L 10 10 L 10 13 L 5 13 Z" stroke-linecap="round" />
						 </g>
						 </svg>  
				 </div>
				 <div x-show.transition="showTooltip2" class="z-40 shadow-lg text-center w-32 block absolute right-0 top-0 p-2 mt-12 rounded-lg bg-gray-800 text-white text-xs">
					 Save Updates
				 </div>
			</div>
			 </div>
		  </div>
 
		  <div class="flex mb-8 justify-between">
			 <div class="w-2/4">
				 <div class="mb-2 md:mb-1 md:flex items-center">
					 <label class="w-32 text-gray-800 block font-bold text-sm uppercase tracking-wide">Numéro de Bon</label>
					 <span class="mr-4 inline-block  md:block">:</span>
					 <div class="flex-1">
					 <input class="bg-gray-200 appearance-none border-2 border-gray-200 rounded w-48 py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-blue-500" id="inline-full-name" type="text" placeholder="eg. #BON-100001" x-model="invoiceNumber">
					 </div>
				 </div>
 
				 <div class="mb-2 md:mb-1 md:flex items-center">
					 <label class="w-32 text-gray-800 block font-bold text-sm uppercase tracking-wide">Date de Bon</label>
					 <span class="mr-4 inline-block  md:block">:</span>
					 <div class="flex-1">
					 <input class="bg-gray-200 appearance-none border-2 border-gray-200 rounded w-48 py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-blue-500 " type="date" x-model="invoiceDate">
					 </div>
				 </div>
 
				 {% comment %} <div class="mb-2 md:mb-1 md:flex items-center">
					 <label class="w-32 text-gray-800 block font-bold text-sm uppercase tracking-wide">Due date</label>
					 <span class="mr-4 hidden md:block">:</span>
					 <div class="flex-1">
					 <input class="bg-gray-200 appearance-none border-2 border-gray-200 rounded w-48 py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-blue-500 js-datepicker-2" id="datepicker2" type="text" placeholder="eg. 17 Mar, 2020" x-model="invoiceDueDate" x-on:change="invoiceDueDate = document.getElementById('datepicker2').value" autocomplete="off" readonly>
					 </div>
				 </div> {% endcomment %}
			 </div>
			 {% comment %} <div>
				 <div class="w-32 h-32 mb-1 border rounded-lg overflow-hidden relative bg-gray-100">
					 <img id="image" class="object-cover w-full h-32" src="https://placehold.co/300x300/e2e8f0/e2e8f0" />
					 
					 <div class="absolute top-0 left-0 right-0 bottom-0 w-full block cursor-pointer flex items-center justify-center" onClick="document.getElementById('fileInput').click()">
						 <button type="button"
							 style="background-color: rgba(255, 255, 255, 0.65)"
							 class="hover:bg-gray-100 text-gray-700 font-semibold py-2 px-4 text-sm border border-gray-300 rounded-lg shadow-sm"
						 >
							 <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-camera" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
								 <rect x="0" y="0" width="24" height="24" stroke="none"></rect>
								 <path d="M5 7h1a2 2 0 0 0 2 -2a1 1 0 0 1 1 -1h6a1 1 0 0 1 1 1a2 2 0 0 0 2 2h1a2 2 0 0 1 2 2v9a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-9a2 2 0 0 1 2 -2" />
								 <circle cx="12" cy="13" r="3" />
							 </svg>							  
						 </button>
					 </div>
				 </div>
				 <input name="photo" id="fileInput" accept="image/*" class="hidden" type="file" onChange="let file = this.files[0]; 
					 var reader = new FileReader();
 
					 reader.onload = function (e) {
						 document.getElementById('image').src = e.target.result;
						 document.getElementById('image2').src = e.target.result;
					 };
				 
					 reader.readAsDataURL(file);
				 ">
			 </div> {% endcomment %}
		  </div>
 
		  <div class="flex flex-wrap justify-between mb-8">
			 <div class="w-full md:w-1/3 mb-2 md:mb-0">
				 <label class="text-gray-800 block mb-1 font-bold text-sm uppercase tracking-wide">Bon Pour :</label>
				 <input class="mb-1 bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-blue-500" id="inline-full-name" type="text" placeholder="Nom Prénom de client" x-model="billing.name">
				 <input class="mb-1 bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-blue-500" id="inline-full-name" type="text" placeholder="Adresse de client" x-model="billing.address">
				 <input class="mb-1 bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-blue-500" id="inline-full-name" type="text" placeholder="Numéro de téléphone" x-model="billing.phone">
		  <input class="mb-1 bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-blue-500" id="inline-full-name" type="text" placeholder="Additional info" x-model="billing.extra">
			 </div>
			 <div class="w-full md:w-1/3">
				 <label class="text-gray-800 block mb-1 font-bold text-sm uppercase tracking-wide">DE la part de :</label>
				 <input class="mb-1 bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-blue-500" id="inline-full-name" type="text" placeholder="Your company name" x-model="from.name" readonly disabled>
 
				 <input class="mb-1 bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-blue-500" id="inline-full-name" type="text" placeholder="Your company address" x-model="from.address" readonly disabled>
 
				 <input class="mb-1 bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-blue-500" id="inline-full-name" type="text" placeholder="Additional info" x-model="from.extra">
			 </div>
		  </div>
 
		  <div class="flex -mx-1 border-b py-2 items-start">
			 <div class="flex-1 px-1">
				 <p class="text-gray-800 uppercase tracking-wide text-sm font-bold">Référence</p>
			 </div>
			 <div class="flex-1 px-1">
				 <p class="text-gray-800 uppercase tracking-wide text-sm font-bold">Description</p>
			 </div>
			 <div class="px-1 w-20 text-right">
				 <p class="text-gray-800 uppercase tracking-wide text-sm font-bold">Units</p>
			 </div>
 
			 <div class="px-1 w-32 text-right">
				 <p class="leading-none">
					 <span class="block uppercase tracking-wide text-sm font-bold text-gray-800">Unit Price</span>
					 {% comment %} <span class="font-medium text-xs text-gray-500">(Incl. GST)</span> {% endcomment %}
				 </p>
			 </div>
 
			 <div class="px-1 w-32 text-right">
				 <p class="leading-none">
					 <span class="block uppercase tracking-wide text-sm font-bold text-gray-800">Amount</span>
					 {% comment %} <span class="font-medium text-xs text-gray-500">(Incl. GST)</span> {% endcomment %}
				 </p>
			 </div>
 
			 <div class="px-1 w-20 text-center">
			 </div>
		  </div>
	 
		  <template  x-for="invoice in items" :key="invoice.id" >
			 <div class="flex -mx-1 py-2 border-b" >
				 <div class="flex-1 px-1" >
					 <p class="text-gray-800" x-text="invoice.ref"></p>
				 </div>
				 <div class="flex-1 px-1" >
					 <p class="text-gray-800" x-text="invoice.name"></p>
				 </div>
 
				 <div class="px-1 w-20 text-right">
					 <p class="text-gray-800" x-text="invoice.qty"></p>
				 </div>
 
				 <div class="px-1 w-32 text-right">
					 <p class="text-gray-800" x-text="numberFormat(invoice.rate)"></p>
				 </div>
 
				 <div class="px-1 w-32 text-right">
					 <p class="text-gray-800" x-text="numberFormat(invoice.total)"></p>
				 </div>
 
				 <div class="px-1 w-20 text-right flex flex-col" >
					 <a href="#" class="text-red-600 text-sm font-semibold mx-auto" @click.prevent="deleteItem(invoice.id)">Delete</a>
					 <a href="#" class="text-green-600 text-sm font-semibold mx-auto" @click.prevent="editItem(invoice)">Edit</a>
				 </div>
			 </div>
		  </template>
 
		  <button class="mt-6 bg-white hover:bg-gray-100 text-gray-700 font-semibold py-2 px-4 text-sm border border-gray-300 rounded shadow-sm" x-on:click="showModal">
			 Add Invoice Items
		  </button>
 
		  <div class="py-2 ml-auto mt-5 w-full sm:w-2/4 lg:w-1/4">
			 {% comment %} <div class="flex justify-between mb-3">
				 <div class="text-gray-800 text-right flex-1">Total incl. GST</div>
				 <div class="text-right w-40">
					 <div class="text-gray-800 font-medium" x-html="netTotal"></div>
				 </div>
			 </div>
			 <div class="flex justify-between mb-4">
				 <div class="text-sm text-gray-600 text-right flex-1">GST(18%) incl. in Total</div>
				 <div class="text-right w-40">
					 <div class="text-sm text-gray-600" x-html="totalGST"></div>
				 </div>
			 </div> {% endcomment %}
		 
			 <div class="py-2 border-t border-b">
				 <div class="flex justify-between">
					 <div class="text-xl text-gray-600 text-right flex-1">Amount due</div>
					 <div class="text-right w-40">
						 <div class="text-xl text-gray-800 font-bold" x-html="netTotal"></div>
					 </div>
				 </div>
			 </div>
			 <div class="flex justify-between">
				 <div></div>
				 <button class="mt-6 bg-white hover:bg-gray-100 text-gray-700 font-semibold py-2 px-4 text-sm border border-gray-300 rounded shadow-sm" type="submit" x-on:click="validateBon">Valider le Bon & imprimer</button>
		  </div>
		  </div>
		 
			 
 
		 
		  <!-- Print Template -->
		  <div id="js-print-template" x-ref="printTemplate" class="hidden">
			 <div class="mb-8 flex justify-between mt-6">
				 <div class="">
					 <h2 class="text-3xl font-bold mb-6 pb-2 tracking-wider uppercase">Bon de Livraison</h2>
 
					 <div class="mb-1 flex items-center">
						 <label class="w-32 text-gray-800 block font-bold text-xs uppercase tracking-wide">Numéro de Bon.</label>
						 <span class="mr-4 inline-block">:</span>
						 <div x-text="invoiceNumber"></div>
					 </div>
		 
					 <div class="mb-1 flex items-center">
						 <label class="w-32 text-gray-800 block font-bold text-xs uppercase tracking-wide">Date de Bon</label>
						 <span class="mr-4 inline-block">:</span>
						 <div x-text="invoiceDate"></div>
					 </div>
				 
				 </div>
				 <div class="pr-5">
					 <div class="w-32 h-32 mb-1 overflow-hidden">
						 <img src="data:image/png;base64,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" class="object-cover w-20 h-20"  />
					 </div>
				 </div>
			 </div>
 
			 <div class="flex justify-between mb-10">
				 <div class="w-1/2 ">
					 <label class="text-gray-800 block mb-2 font-bold text-xl uppercase tracking-wide">Bon Pour:</label>
					  <div>
						 <div class="mb-1 flex items-center">
							 <label class="w-fit mr-4 text-gray-800 block font-medium text-xs uppercase tracking-wide"> Nom Client : </label>
							 <div x-text="billing.name"></div>
						 </div>
						 <div class="mb-1 flex items-center">
							 <label class="w-fit mr-4 text-gray-800 block font-medium text-xs uppercase tracking-wide"> Adresse Client : </label>
							 <div x-text="billing.address"></div>
						 </div>
						 <div class="mb-1 flex items-center">
							 <label class="w-fit mr-4 text-gray-800 block font-medium text-xs uppercase tracking-wide"> Téléphone Client : </label>
							 <div x-text="billing.phone"></div>
						 </div>
						 <div class="mb-1 flex items-center">
							 <label class="w-fit mr-4 text-gray-800 block font-medium text-xs uppercase tracking-wide"> Extra : </label>
							 <div x-text="billing.extra"></div>
						 </div>
					  </div>
			   </div>
				 <div class="w-1/2">
					 <label class="text-gray-800 block mb-2 font-bold text-xl uppercase tracking-wide">DE la part de :</label>
					 <div>
						 <div class="mb-1 flex items-center">
							 <label class="w-fit mr-4 text-gray-800 block font-medium text-xs uppercase tracking-wide"> Entreprise : </label>
							 <div x-text="from.name"></div>
						 </div>
						 <div class="mb-1 flex items-center">
							 <label class="w-fit mr-4 text-gray-800 block font-medium text-xs uppercase tracking-wide"> Adresse: </label>
							 <div x-text="from.address"></div>
						 </div>
						 <div class="mb-1 flex items-center">
							 <label class="w-fit text-gray-800 block font-medium text-xs uppercase tracking-wide"> Extra : </label>
							 <div x-text="from.extra"></div>
						 </div>
						 
					 </div>
				 </div>
			 </div>
 
			 <div class="flex  -mx-1 border-b py-2 items-start">
				 <div class="flex-1 px-1 ">
					 <p class="text-gray-600 uppercase tracking-wide text-lg font-bold">Reference</p>
				 </div>

				 <div class="flex-1 px-1 ">
					 <p class="text-gray-600 uppercase tracking-wide text-lg font-bold">Description</p>
				 </div>
	 
				 <div class="px-1 w-32 text-right">
					 <p class="text-gray-600 uppercase tracking-wide text-lg font-bold">Units</p>
				 </div>
	 
				 <div class="px-1 w-32 text-right">
					 <p class="leading-none">
						 <span class="block uppercase tracking-wide text-lg font-bold text-gray-600">Unit Price</span>
						 {% comment %} <span class="font-medium text-xs text-gray-500">(Incl. GST)</span> {% endcomment %}
					 </p>
				 </div>
	 
				 <div class="px-1 w-32 text-right">
					 <p class="leading-none">
						 <span class="block uppercase tracking-wide text-lg font-bold text-gray-600">Amount</span>
						 {% comment %} <span class="font-medium text-xs text-gray-500">(Incl. GST)</span> {% endcomment %}
					 </p>
				 </div>
			 </div>
				 
			 <template  x-for="invoice in items" :key="invoice.id" >
				 <div class="flex -mx-1 py-2 border-b" >
					 <div class="flex-1  px-1" >
						 <p class="text-gray-800" x-text="invoice.ref"></p>
					 </div>
					 <div class="flex-1 px-1" >
						 <p class="text-gray-800" x-text="invoice.name"></p>
					 </div>
	 
					 <div class="px-1  text-right">
						 <p class="text-gray-800" x-text="invoice.qty"></p>
					 </div>
	 
					 <div class="px-1 w-32 text-right">
						 <p class="text-gray-800" x-text="numberFormat(invoice.rate)"></p>
					 </div>
	 
					 <div class="px-1 w-32 text-right">
						 <p class="text-gray-800" x-text="numberFormat(invoice.total)"></p>
					 </div>                    
				 </div>
			  </template>
	 
 
			 <div class="py-2 ml-auto mt-20" style="width: 320px">
				 <div class="flex justify-between mb-3">
					  <div class="text-gray-800 text-right flex-1">Total </div> 
					 <div class="text-right w-40">
						 <div class="text-gray-800 font-semibold" x-html="netTotal"></div>
					 </div>
				 </div>
				 <div class="flex justify-between mb-4">
					 {% comment %} <div class="text-sm text-gray-600 text-right flex-1">GST(18%) incl. in Total</div> {% endcomment %}
					 {% comment %} <div class="text-right w-40">
						 <div class="text-sm text-gray-600 font-semibold" x-html="totalGST"></div>
					 </div> {% endcomment %}
				 </div>
			 
				 <div class="py-2 border-t border-b">
					 <div class="flex justify-between">
						 <div class="text-xl text-gray-600 text-right flex-1 mr-4">Total Amount</div>
						 <div class="text-right ">
							 <div class="text-xl text-gray-800 font-bold" x-html="netTotal"></div>
						 </div>
					 </div>
				 </div>
			 </div>
		  </div>
		  <!-- /Print Template -->
 
		  <!-- Modal -->
		  <div style=" background-color: rgba(0, 0, 0, 0.8); " class="fixed z-40 top-0 right-0 left-0 bottom-0 h-full w-full" x-cloak x-show.transition.opacity="openModal">
			 <div class="p-4 max-w-xl mx-auto relative left-0 right-0 overflow-hidden mt-24">
				 <div class="shadow absolute right-0 top-0 w-10 h-10 rounded-full bg-white text-gray-500 hover:text-gray-800 inline-flex items-center justify-center cursor-pointer"
					 x-on:click="openModal = !openModal">
					 <svg class="fill-current w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
						 <path
							 d="M16.192 6.344L11.949 10.586 7.707 6.344 6.293 7.758 10.535 12 6.293 16.242 7.707 17.656 11.949 13.414 16.192 17.656 17.606 16.242 13.364 12 17.606 7.758z" />
					 </svg>
				 </div>
		  <form action="" id="myForm">
		   <div class="shadow w-full rounded-lg bg-white overflow-hidden block p-8">		
			 <h2 class="font-bold text-2xl mb-6 text-gray-800 border-b pb-2">Ajouter des produits au bon</h2>
			   <div class="mb-4">
				 <label class="block text-gray-700 font-semibold mb-2" for="product">
				   Product Name or Code:
				 </label>
				 <select
				 class="appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
				 id="product"
				 name="product"
				 x-model="item.ref"
				 x-on:change="
				  item.ref = $event.target.value;
				  item.name=$event.target.selectedOptions[0].dataset.name;
				  item.price = $event.target.selectedOptions[0].dataset.price;
				  item.quantity = $event.target.selectedOptions[0].dataset.quantity;
				  showQuantity = true;
				  document.getElementById('price').value = item.price;"
				 required  
			   >
			   {% for stock_item in stock %}
			   <option
			   value="{{ stock_item.product.reference }}"
			   data-quantity="{{ stock_item.quantity }}"
			   :selected="{{stock_item.product.name}} === item.name" 
			   >
				 <option value="{{ stock_item.product.reference }}" data-name ={{stock_item.product.name}} data-price="{{ stock_item.product.price }}" data-quantity="{{ stock_item.quantity }}">
					 {{ stock_item.product.name }} 
				 </option>
			 {% endfor %}
			   </select>
			   </div>
		   
			   <div class="mb-4">
				 <label class="block text-gray-700 font-semibold mb-2" for="quantity">
				   Quantity:
				   <div class="mb-4" id="productQuantityDiv" style="display: none;" x-show="showQuantity">
					 <label class="block text-primary font-medium text-sm mb-2">
					   Available Quantity: <span id="productQuantity"></span>
					 </label>
				   </div>
				 </label>
				 <input
				   class="appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
				   type="number"
				   id="quantity"
				   name="quantity"
				   placeholder="Enter quantity"
				   required
				   x-model="item.qty"					
				 >
			   </div>
 
			   <div class="mb-4">
				 <label class="block text-gray-700 font-semibold mb-2" for="price">
				   Price:
				 </label>
				 <input
				   class="appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
				   type="text"
				   id="price"
				   name="price"
				   placeholder="Price will be fetched automatically"
				   x-model="item.rate"
				 >
			   </div>
			   <div class="mt-8 text-right">
				 <button type="button" class="bg-white hover:bg-gray-100 text-gray-700 font-semibold py-2 px-4 border border-gray-300 rounded shadow-sm mr-2" @click="openModal = !openModal">
				   Cancel
				 </button>	
				 <button type="button" class="bg-gray-800 hover:bg-gray-700 text-white font-semibold py-2 px-4 border border-gray-700 rounded shadow-sm"
				 @click="operationType === 'update' ? updateItem() : addItem()">
				 <span x-text="operationType === 'update' ? 'Update Item' : 'Add Item'"></span>
				 </button>	
			   </div>
			 </div> 
		   </div>
		  </form>
			 </div>
		  </div>
		 <!-- /Modal -->
 
	 </div>
	 
	 <script src="https://cdn.jsdelivr.net/npm/pikaday/pikaday.js"></script>
 <script>		
   window.addEventListener('DOMContentLoaded', function() {
	 const productDropdown = document.getElementById('product');
	 const quantityInput = document.getElementById('quantity');
	 const priceInput = document.getElementById('price');
 
	 // Event listener for when the selected product changes
	 productDropdown.addEventListener('change', (event) => {
	 // Get the selected product ID, its associated price, and available quantity from the data attributes
	 const selectedProductId = event.target.value;
	 const selectedProductOption = event.target.selectedOptions[0];
	 const selectedProductPrice = selectedProductOption.dataset.price;
	 const availableQuantity = selectedProductOption.dataset.quantity;

	 // Update the price input with the selected product's price
	 priceInput.value = selectedProductPrice;
	 productQuantityDiv.style.display = 'block';
	 productQuantity.textContent = availableQuantity; 
 
   });
   });
 
	 function invoices() {
			 return {
				 items:[],
				 originalItems:[],
				 invoiceNumber: '{{idBon}}',
				 invoiceDate: '{{dateBon}}',
			 
 
				 totalGST: 0,
				 netTotal: {{totalPrice}},
   
				 item: {
					 id: '',
					 name: '',
					 ref:'',
					 qty: 0,
					 rate: 0,
					 total: 0,
					 gst: 18
				 },
 
				 billing: {
					 name: '{{client_name }}',
					 address: '{{client_address}}',
					 extra: '',
					 phone:'{{client_phone}}'
				 },

				 from: {
					 name: '{{selected_store.name}}',
					 address: '{{selected_store.location}}',
					 extra: ''
				 },
 
				 showTooltip: false,
				 showTooltip2: false,
				 openModal: false,
				 operationType: 'add',
				 $watch: ['item.qty', 'item.rate'],
				 recalculateTotal() {
				   this.item.total = this.item.qty * this.item.rate;
				 }, 
				 showQuantity:false,

				 showModal(){
				  document.getElementById('myForm').reset(); 
				  this.operationType= 'add';
				  this.showQuantity = false; 
				  this.openModal =true;                    
				 },
  
				 initData() {
					 // Iterate over the itemsData and create item objects
					 itemsData={{ items|safe }}
					 for (const itemData of itemsData) {
						
					   const item = {
						 id: this.generateUUID(),
						 name: itemData.produit_name,
						 ref: itemData.produit_ref,
						 qty: itemData.produit_qty,
						 rate: itemData.produit_unitPrice,
						 total: itemData.prdouit_totalPrice,
						 gst: 20 // You can add a default value for the gst property here
					   };
					   this.items.push(item);
					   this.originalItems.push(item)// Push the item object into the items list
					 }
				 },

				 editItem(invoiceData) {
				   // Set the 'item' data to the selected invoiceData
					 this.showQuantity = true;
					 this.item = {
					   id: invoiceData.id,
					   name: invoiceData.name,
					   ref: invoiceData.ref,
					   qty: invoiceData.qty,
					   rate: invoiceData.rate,
					   total: invoiceData.total,
					   // Add other properties as needed
					 };
					 // Open the modal
					 this.operationType = 'update';
					 this.openModal = true;
				 },

				 updateItem(){
					 const index = this.items.findIndex((item) => item.id === this.item.id);
					 
					 if (index !== -1) {
						 this.item.rate = parseFloat(document.getElementById('price').value);
						 this.items[index].total=this.item.qty * this.item.rate;
						this.items[index] = this.item;
					 }
					   // Close the modal after successful update
					 this.openModal = false;
					 this.recalculateTotal();
					 
				 },

				 openPrintTemplate() {
					 var printContents = this.$refs.printTemplate.innerHTML;
					 document.body.innerHTML = printContents;
				   },
				 addItem() {
					 this.item.rate = document.getElementById('price').value;
					 this.items.push({
						 id: this.generateUUID(),
						 name: this.item.name,
						 ref:this.item.ref,
						 qty: this.item.qty,
						 rate: this.item.rate,
						 gst: this.calculateGST(this.item.gst, this.item.rate),
						 total: this.item.qty * this.item.rate
					 })
					 console.log(this.item.rate)
					 this.itemTotal();
					 this.itemTotalGST();
 
					 this.item.id = '';
					 this.item.name = '';
					 this.item.qty = 0;
					 this.item.rate = 0;
					 this.item.gst = 18;
					 this.item.total = 0;
					 document.getElementById('myForm').reset(); 
					 this.showQuantity = false; 
					 this.openModal=false;
				 },
 
				 deleteItem(uuid) {
					 this.items = this.items.filter(item => uuid !== item.id);
					 this.itemTotal();
					 this.itemTotalGST();
				 },
 
				 itemTotal() {
					 this.netTotal = this.numberFormat(this.items.length > 0 ? this.items.reduce((result, item) => {
						 return result + item.total;
					 }, 0) : 0);
				 },
 
				 itemTotalGST() {
					 this.totalGST =  this.numberFormat(this.items.length > 0 ? this.items.reduce((result, item) => {
						 return result + (item.gst * item.qty);
					 }, 0) : 0);
				 },
 
				 calculateGST(GSTPercentage, itemRate) {
					 return this.numberFormat((itemRate - (itemRate * (100 / (100 + GSTPercentage)))).toFixed(2));
				 },
 
				 generateUUID() {
					 return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
						 var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
						 return v.toString(16);
					 });
				 },
 
				 /*generateInvoiceNumber(minimum, maximum) {
					 const randomNumber = Math.floor(Math.random() * (maximum - minimum)) + minimum;
					 this.invoiceNumber = '#BL-'+ randomNumber;
				 },*/
 
				 numberFormat(amount) {
					 return amount.toLocaleString("fr-FR", {
						 style: "currency",
						 currency: "DZD"
					 });
				 },
 
				 printInvoice() {
					 var printContents = this.$refs.printTemplate.innerHTML;
					 var originalContents = document.body.innerHTML;
					 document.body.innerHTML = printContents;
					 window.print();
					 window.location.reload();
					 document.body.innerHTML = originalContents;
 
					 this.items=[];
				 },
				 saveItem() {
					 if (!this.initialPageState) {
					   this.initialPageState = document.documentElement.outerHTML;
					 }
					 const currentPageState = document.documentElement.outerHTML;
					 const isPageChanged = currentPageState !== this.initialPageState;
			 
					 if (isPageChanged) {
					   console.log('Saving changes or data on the page.');
			 
					   // Close the modal after successful save
					   this.openModal = false;
					 } else {
					   // Display a message indicating that no changes were made
					   alert('No changes were made.');
			 
					   // Close the modal without saving
					   this.openModal = false;
					 }
				   },
				 validateBon(){
					 const numericNetTotal = parseFloat(this.netTotal);
					 const dataObj = {
						 IdBon : this.invoiceNumber,
						 dateBp:this.invoiceDate,
						 clientInfo:this.billing,
						 total:numericNetTotal,
						 produits:this.items
					 };
					 if(JSON.stringify(this.items) === JSON.stringify(this.originalItems)){
						 console.log("no change in items");     
						 if(this.billing.name == '{{client_name}}')   {
							 console.log("no change in client name either");
							 if(this.invoiceDate === '{{dateBon}}'){
								 console.log("no not the date ...")
							 }
						 }                   
					 }else{
						 console.log("this is updated items list"+JSON.stringify(this.items));
						 console.log("this is the original items List"+JSON.stringify(this.originalItems));
					 }
					   // Send the data to Django using Axios
					  console.log('Validating Bon ...',numericNetTotal);
		   axios.post('', {
			   formData: dataObj
			 }, {
			   headers: {
				 'Content-Type': '',
				 'X-CSRFToken': getCookie('csrftoken'),
			   }
			 })
			 .then((response) => {
				 data= response.data
			   // {# response.data.message #}�
			   console.log('HNAA RANI -_-')
			   console.log(data.error)
			   if(data.error){
				 alert(data.error);
			   }else{
				 alert("Bon Validé, you can print it");
			   }		  
			 })
			 .catch((error) => {
			   console.log(error)
			 });
						 
				 },
				 
			 }
		 }
		 function getCookie(name) {
			 var cookieValue = null;
			 if (document.cookie && document.cookie !== '') {
				 var cookies = document.cookie.split(';');
				 for (var i = 0; i < cookies.length; i++) {
					 var cookie = cookies[i].trim();
					 // Does this cookie string begin with the name we want?
					 if (cookie.substring(0, name.length + 1) === (name + '=')) {
						 cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
						 break;
					 }
				 }
			 }
			 return cookieValue;
		 }
	 </script>
</body>	
	<!-- end Main content  -->

  </div>
</div>
</div>
</div>

{% endblock content %}
